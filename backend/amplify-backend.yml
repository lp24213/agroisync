version: 1
applications:
  - appRoot: .
    env:
      variables:
        NODE_ENV: production
        PORT: 3001
        ALLOWED_ORIGINS: https://agroisync.com,https://www.agroisync.com,https://api.agroisync.com
        FIREBASE_ADMIN_PROJECT_ID: ${FIREBASE_ADMIN_PROJECT_ID}
        FIREBASE_ADMIN_CLIENT_EMAIL: ${FIREBASE_ADMIN_CLIENT_EMAIL}
        FIREBASE_ADMIN_PRIVATE_KEY: ${FIREBASE_ADMIN_PRIVATE_KEY}
        FIREBASE_ADMIN_CLIENT_X509_CERT_URL: ${FIREBASE_ADMIN_CLIENT_X509_CERT_URL}
        FIREBASE_DATABASE_URL: ${FIREBASE_DATABASE_URL}
        FIREBASE_STORAGE_BUCKET: ${FIREBASE_STORAGE_BUCKET}
        MONGODB_URI: ${MONGODB_URI}
        JWT_SECRET: ${JWT_SECRET}
        COINMARKETCAP_API_KEY: ${COINMARKETCAP_API_KEY}
        SOLANA_RPC_URL: ${SOLANA_RPC_URL}
        ETHEREUM_RPC_URL: ${ETHEREUM_RPC_URL}
    backend:
      phases:
        preBuild:
          commands:
            - npm ci --no-audit --prefer-offline --legacy-peer-deps
        build:
          commands:
            - node -e "console.log('Backend configurado')"
        postBuild:
          commands:
            - ls -la
      artifacts:
        baseDirectory: .
        files:
          - '**/*'
          - '!node_modules/**'
          - '!tests/**'
          - '!docs/**'
      cache:
        paths:
          - node_modules/**
          - ~/.npm/**
          - ~/.cache/**
