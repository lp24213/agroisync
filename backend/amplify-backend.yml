# CONFIGURA√á√ÉO AMPLIFY BACKEND PROFISSIONAL - AGROISYNC.COM
# SEGURAN√áA TOTAL - VARI√ÅVEIS DE AMBIENTE SEGURAS
version: 1
applications:
  - appRoot: .
    env:
      variables:
        NODE_ENV: production
        PORT: 3001
        ALLOWED_ORIGINS: https://agroisync.com,https://www.agroisync.com,https://api.agroisync.com
        # Firebase - Configura√ß√£o segura via vari√°veis de ambiente
        FIREBASE_ADMIN_PROJECT_ID: ${FIREBASE_ADMIN_PROJECT_ID}
        FIREBASE_ADMIN_CLIENT_EMAIL: ${FIREBASE_ADMIN_CLIENT_EMAIL}
        FIREBASE_ADMIN_PRIVATE_KEY: ${FIREBASE_ADMIN_PRIVATE_KEY}
        FIREBASE_ADMIN_CLIENT_X509_CERT_URL: ${FIREBASE_ADMIN_CLIENT_X509_CERT_URL}
        FIREBASE_DATABASE_URL: ${FIREBASE_DATABASE_URL}
        FIREBASE_STORAGE_BUCKET: ${FIREBASE_STORAGE_BUCKET}
        # MongoDB - Configura√ß√£o segura
        MONGODB_URI: ${MONGODB_URI}
        # JWT - Configura√ß√£o segura
        JWT_SECRET: ${JWT_SECRET}
        # APIs Externas - Configura√ß√£o segura
        COINMARKETCAP_API_KEY: ${COINMARKETCAP_API_KEY}
        SOLANA_RPC_URL: ${SOLANA_RPC_URL}
        ETHEREUM_RPC_URL: ${ETHEREUM_RPC_URL}
    backend:
      phases:
        preBuild:
          commands:
            - echo "üöÄ INICIANDO BUILD BACKEND AGROISYNC.COM"
            - echo "üì¶ Instalando depend√™ncias..."
            - npm ci --no-audit --prefer-offline --legacy-peer-deps
            - echo "‚úÖ Depend√™ncias instaladas com sucesso!"
        build:
          commands:
            - echo "üî® Verificando configura√ß√£o..."
            - node -e "console.log('‚úÖ Backend configurado corretamente')"
            - echo "‚úÖ Build backend conclu√≠do!"
        postBuild:
          commands:
            - echo "üìÅ Verificando arquivos..."
            - ls -la
            - echo "üéâ BACKEND AGROISYNC.COM CONCLU√çDO!"
      artifacts:
        baseDirectory: .
        files:
          - '**/*'
          - '!node_modules/**'
          - '!tests/**'
          - '!docs/**'
      cache:
        paths:
          - node_modules/**
          - ~/.npm/**
          - ~/.cache/**
