# AgroSync Backend - Cloudflare Worker Configuration
name = "agroisync-backend"
main = "src/cloudflare-worker.js"
compatibility_date = "2024-09-23"
compatibility_flags = ["nodejs_compat"]

# Worker configuration
workers_dev = true

# Routes are managed in Cloudflare Dashboard to avoid conflicts
# Route management: https://dash.cloudflare.com/00d72b2db0c988d8de0db5442b8d6450/workers/overview

# D1 Database binding
[[d1_databases]]
binding = "DB"
database_name = "agroisync-db"
database_id = "a3eb1069-9c36-4689-9ee9-971245cb2d12"

# KV Namespaces
[[kv_namespaces]]
binding = "SESSIONS"
id = "13903703f9474a8181e852306a287eb7"

[[kv_namespaces]]
binding = "CACHE"
id = "8a07f2664b154e84a26ca3f95836378d"

# Environment Variables
[vars]
NODE_ENV = "production"
API_VERSION = "v1"
FRONTEND_URL = "https://agroisync.com"
API_URL = "https://agroisync.com/api"
LOG_LEVEL = "info"

# Turnstile Configuration
CF_TURNSTILE_SITE_KEY = "0x4AAAAAAB3pdjs4jRKvAtaA"
# IMPORTANT: Move secrets to Wrangler secrets with:
#  npx wrangler secret put CF_TURNSTILE_SECRET_KEY
#  npx wrangler secret put RESEND_API_KEY
#  npx wrangler secret put JWT_SECRET
#  npx wrangler secret put JWT_REFRESH_SECRET
# Do NOT store sensitive secrets in this file for production.
# CF_TURNSTILE_SECRET_KEY = "<set-via-wrangler-secret>"
CF_TURNSTILE_ENABLED = "true"

# Email Configuration (Resend)
RESEND_FROM_EMAIL = "AgroSync <contato@agroisync.com>"
RESEND_DOMAIN = "agroisync.com"
RESEND_ENABLED = "true"

# Stripe Configuration (DEPRECATED - usando Santander agora)
STRIPE_ENABLED = "false"
# STRIPE_WEBHOOK_SECRET should be set as a secret in production:
# npx wrangler secret put STRIPE_WEBHOOK_SECRET

# Santander Configuration
SANTANDER_ENABLED = "true"

# JWT Configuration
JWT_EXPIRES_IN = "7d"
JWT_REFRESH_EXPIRES_IN = "30d"

# Security
ENABLE_CSRF = "true"
SECURE_HEADERS = "true"
XSS_PROTECTION = "true"

# CORS
CORS_ALLOWED_ORIGINS = "https://agroisync.com,https://www.agroisync.com"

# Cloudflare AI Workers (GR√ÅTIS!)
[ai]
binding = "AI"

# Observability configuration
[observability]
enabled = true

[observability.logs]
enabled = true
head_sampling_rate = 1
invocation_logs = true

# Note: Sensitive secrets should be set using:
# wrangler secret put RESEND_API_KEY
# wrangler secret put JWT_SECRET
# wrangler secret put JWT_REFRESH_SECRET
