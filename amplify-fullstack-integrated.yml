version: 1
applications:
  - frontend:
      phases:
        preBuild:
          commands:
            - echo "ğŸš€ Iniciando build do AGROISYNC Frontend no Linux..."
            - echo "ğŸ“‹ InformaÃ§Ãµes do sistema:"
            - uname -a
            - echo "ğŸ“‹ VersÃµes do ambiente:"
            - node --version
            - npm --version
            - echo "ğŸ“‹ DiretÃ³rio atual:"
            - pwd
            - echo "ğŸ“¦ Instalando dependÃªncias..."
            - npm ci
            - echo "âš™ï¸ Configurando Next.js para Amplify..."
            - cp frontend/next.config-final.js frontend/next.config.js
            - cp frontend/tsconfig-amplify.json frontend/tsconfig.json
            - echo "ğŸ”§ ConfiguraÃ§Ãµes aplicadas com sucesso"
            - echo "ğŸ“ Estrutura atual:"
            - ls -la
        build:
          commands:
            - echo "ğŸ—ï¸ Buildando aplicaÃ§Ã£o..."
            - cd frontend && npm run build
            - echo "ğŸ“ Verificando estrutura apÃ³s build..."
            - pwd
            - ls -la
            - echo "ğŸ“ Verificando pasta out..."
            - ls -la frontend/out/
            - echo "ğŸ“„ Verificando index.html..."
            - ls -la frontend/out/index.html
            - echo "ğŸ“„ ConteÃºdo inicial do index.html:"
            - head -10 frontend/out/index.html
            - echo "âœ… Build concluÃ­do com sucesso!"
            - echo "ğŸ¯ Frontend pronto para deploy no Amplify!"
      artifacts:
        baseDirectory: frontend/out
        files:
          - '**/*'
      cache:
        paths:
          - frontend/node_modules/**/*
          - frontend/.next/cache/**/*
  
  - backend:
      phases:
        preBuild:
          commands:
            - echo "ğŸš€ Iniciando build do AGROISYNC Backend no Linux..."
            - echo "ğŸ“‹ InformaÃ§Ãµes do sistema:"
            - uname -a
            - echo "ğŸ“‹ VersÃµes do ambiente:"
            - node --version
            - npm --version
            - echo "ğŸ“‹ DiretÃ³rio atual:"
            - pwd
            - echo "ğŸ“¦ Instalando dependÃªncias..."
            - cd backend && npm ci
            - echo "ğŸ”§ ConfiguraÃ§Ãµes aplicadas com sucesso"
            - echo "ğŸ“ Estrutura atual:"
            - ls -la
        build:
          commands:
            - echo "ğŸ—ï¸ Buildando aplicaÃ§Ã£o..."
            - cd backend && npm run build
            - echo "ğŸ“ Verificando estrutura apÃ³s build..."
            - pwd
            - ls -la
            - echo "ğŸ“ Verificando arquivos de build..."
            - ls -la backend/dist/ || echo "Pasta dist nÃ£o encontrada"
            - echo "âœ… Build concluÃ­do com sucesso!"
            - echo "ğŸ¯ Backend pronto para deploy no Amplify!"
      artifacts:
        baseDirectory: backend
        files:
          - '**/*'
          - '!node_modules/**/*'
          - '!tests/**/*'
          - '!coverage/**/*'
          - '!.git/**/*'
      cache:
        paths:
          - backend/node_modules/**/*
