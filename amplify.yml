version: 1
applications:
  - appRoot: frontend
    frontend:
      phases:
        preBuild:
          commands:
            - echo "ğŸš€ Iniciando deploy profissional do AgroSync..."
            - echo "ğŸ“¦ Instalando dependÃªncias do frontend..."
            - npm ci --prefer-offline --no-audit
            - echo "ğŸ” Verificando versÃµes..."
            - node --version
            - npm --version
            - echo "ğŸ”§ Configurando variÃ¡veis de ambiente..."
            - echo "REACT_APP_API_URL=$REACT_APP_API_URL" >> .env.production
            - echo "REACT_APP_STRIPE_PUBLISHABLE_KEY=$REACT_APP_STRIPE_PUBLISHABLE_KEY" >> .env.production
            - echo "REACT_APP_WEB3_PROVIDER=$REACT_APP_WEB3_PROVIDER" >> .env.production
            - echo "REACT_APP_CHATBOT_API_KEY=$REACT_APP_CHATBOT_API_KEY" >> .env.production
        build:
          commands:
            - echo "ğŸ—ï¸ Construindo aplicaÃ§Ã£o frontend profissional..."
            - npm run build
            - echo "âœ… Build do frontend concluÃ­do com sucesso!"
            - echo "ğŸ“Š Verificando tamanho do build..."
            - du -sh build/
            - echo "ğŸ” Verificando arquivos gerados..."
            - ls -la build/
      artifacts:
        baseDirectory: build
        files:
          - '**/*'
      cache:
        paths:
          - node_modules/**/*
          - .npm/**/*
          - build/**/*
    backend:
      phases:
        preBuild:
          commands:
            - echo "ğŸ”§ Configurando backend profissional..."
            - cd backend
            - echo "ğŸ“¦ Instalando dependÃªncias do backend..."
            - npm ci --prefer-offline --no-audit
            - echo "ğŸ” Verificando versÃµes do backend..."
            - node --version
            - npm --version
            - echo "ğŸ” Configurando variÃ¡veis de ambiente do backend..."
            - echo "MONGODB_URI=$MONGODB_URI" >> .env.production
            - echo "JWT_SECRET=$JWT_SECRET" >> .env.production
            - echo "STRIPE_SECRET_KEY=$STRIPE_SECRET_KEY" >> .env.production
            - echo "REDIS_URL=$REDIS_URL" >> .env.production
        build:
          commands:
            - echo "ğŸ—ï¸ Construindo aplicaÃ§Ã£o backend profissional..."
            - npm run build
            - echo "âœ… Build do backend concluÃ­do com sucesso!"
            - echo "ğŸ“Š Verificando tamanho do build do backend..."
            - du -sh dist/
      artifacts:
        baseDirectory: backend/dist
        files:
          - '**/*'
      cache:
        paths:
          - backend/node_modules/**/*
          - backend/.npm/**/*
          - backend/dist/**/*