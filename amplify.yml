version: 1
frontend:
  phases:
    preBuild:
      commands:
        - echo "=== INSTALANDO NODE.JS CORRETO ==="
        - nvm install 20.18.0
        - nvm use 20.18.0
        - node --version
        - npm --version
        - echo "=== ENTRANDO NO DIRETÓRIO FRONTEND ==="
        - cd frontend
        - echo "=== LIMPANDO INSTALAÇÕES ANTERIORES ==="
        - rm -rf node_modules package-lock.json .next
        - echo "=== INSTALANDO DEPENDÊNCIAS DO FRONTEND ==="
        - npm install
    build:
      commands:
        - echo "=== INICIANDO BUILD DO FRONTEND ==="
        - npm run build
        - echo "=== BUILD COMPLETADO ==="
        - ls -la .next
        - echo "=== VERIFICANDO ARQUIVOS ==="
        - find .next -name "*.js" | head -10
  artifacts:
    baseDirectory: frontend/.next
    files:
      - '**/*'
  cache:
    paths:
      - frontend/node_modules/**/*
      - frontend/.next/cache/**/*
