version: 1
frontend:
  phases:
    preBuild:
      commands:
        - echo "=== CONFIGURAÇÃO PERFEITA PARA AWS AMPLIFY ==="
        - echo "Entrando no diretório frontend..."
        - cd frontend
        - echo "Verificando versão do Node.js..."
        - node --version
        - echo "Verificando versão do npm..."
        - npm --version
        - echo "Limpando instalações anteriores..."
        - rm -rf node_modules package-lock.json .next
        - echo "Instalando dependências..."
        - npm install
        - echo "Verificando dependências instaladas..."
        - npm list --depth=0 | head -10
    build:
      commands:
        - echo "=== INICIANDO BUILD PERFEITO ==="
        - echo "Verificando configurações..."
        - ls -la *.config.*
        - echo "Iniciando build..."
        - npm run build:amplify
        - echo "=== BUILD CONCLUÍDO COM SUCESSO ==="
        - echo "Verificando arquivos gerados..."
        - ls -la .next
        - echo "Verificando tamanho dos arquivos..."
        - du -sh .next
  artifacts:
    baseDirectory: frontend/.next
    files:
      - '**/*'
  cache:
    paths:
      - frontend/node_modules/**/*
      - frontend/.next/cache/**/*
