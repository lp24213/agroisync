version: 1
frontend:
  phases:
    preBuild:
      commands:
        - echo "ğŸš€ Iniciando build do AGROISYNC Frontend no Linux..."
        - echo "ğŸ“‹ InformaÃ§Ãµes do sistema:"
        - uname -a
        - echo "ğŸ“‹ VersÃµes do ambiente:"
        - node --version
        - npm --version
        - echo "ğŸ“‹ DiretÃ³rio atual:"
        - pwd
        - echo "ğŸ“¦ Instalando dependÃªncias..."
        - npm ci
        - echo "âš™ï¸ Configurando Next.js para Amplify..."
        - cp next.config-final.js next.config.js
        - cp tsconfig-amplify.json tsconfig.json
        - echo "ğŸ”§ ConfiguraÃ§Ãµes aplicadas com sucesso"
        - echo "ğŸ“ Estrutura atual:"
        - ls -la
        - echo "ğŸ“ Verificando arquivos de configuraÃ§Ã£o:"
        - ls -la next.config*.js
        - ls -la tsconfig*.json
    build:
      commands:
        - echo "ğŸ—ï¸ Buildando aplicaÃ§Ã£o..."
        - npm run build
        - echo "ğŸ“ Verificando estrutura apÃ³s build..."
        - pwd
        - ls -la
        - echo "ğŸ“ Verificando pasta out..."
        - ls -la out/
        - echo "ğŸ“„ Verificando index.html..."
        - ls -la out/index.html
        - echo "ğŸ“„ ConteÃºdo inicial do index.html:"
        - head -10 out/index.html
        - echo "ğŸ“Š Tamanho dos arquivos principais:"
        - ls -lh out/index.html
        - ls -lh out/_next/static/css/*.css | head -3
        - echo "âœ… Build concluÃ­do com sucesso!"
        - echo "ğŸ¯ Arquivos prontos para deploy no Amplify!"
        - echo "ğŸ“Š Resumo do build:"
        - echo "   - Pasta out criada: $(test -d out && echo 'SIM' || echo 'NÃƒO')"
        - echo "   - index.html existe: $(test -f out/index.html && echo 'SIM' || echo 'NÃƒO')"
        - echo "   - Total de arquivos: $(find out -type f | wc -l)"
  artifacts:
    baseDirectory: out
    files:
      - '**/*'
  cache:
    paths:
      - node_modules/**/*
      - .next/cache/**/*
